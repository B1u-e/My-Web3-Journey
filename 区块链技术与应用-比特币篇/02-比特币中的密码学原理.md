# 第二讲：比特币中的密码学原理

## 概述

比特币中使用的密码学技术主要包括：**Cryptographic Hash Function（密码学哈希函数）**和**数字签名**。这些技术为比特币系统提供了安全性和不可篡改性的保障。

---

## 哈希算法

### 哈希算法概述

哈希算法是一种**将任意长度的数据**映射为**固定长度的散列值**（也称为哈希值、摘要或指纹）的算法。

### 哈希算法的主要特点

1. **确定性（Determinism）**：相同的输入总是产生相同的输出
2. **快速计算（高效性）**：对于给定的输入，哈希值可以迅速计算出来
3. **抗碰撞性(Collision resistance)**：很难找到两个不同的输入，它们的哈希值相同（称为哈希碰撞）
4. **不可逆性（单向性）**：根据哈希值不能轻易逆推出原始输入
5. **扩展性弱**：微小的输入变化会导致哈希值的巨大差异（雪崩效应）
6. **隐藏性（Hiding）**：隐藏性确保了即使知道哈希值，也不能推测出输入值的任何信息
7. **Puzzle-friendly**：在特定条件下找到一个满足要求的哈希值应当是计算上困难的。这个特性在工作量证明等机制中非常关键

### 常见的哈希算法

- **MD5**：产生 128 位的哈希值，曾经广泛用于数据完整性校验，但由于其抗碰撞性较弱，现在逐渐被弃用
- **SHA-1**：产生 160 位的哈希值，也曾经广泛使用，但由于安全漏洞，已经不再推荐使用
- **SHA-256**：属于 SHA-2 家族，产生 256 位的哈希值，广泛应用于安全性要求较高的场景，如区块链、数字签名等

---

## 哈希算法的核心特性

### 1. Collision resistance（抗碰撞性）

**Collision resistance（抗碰撞性）** 是哈希算法的重要属性之一。它指的是对于给定的哈希函数，很难找到两个不同的输入，它们的哈希值是相同的。

换句话说，抗碰撞性意味着虽然理论上可能存在两个不同的输入产生相同的哈希值（这种情况称为"碰撞"），但要找到这两个不同的输入是非常困难的。

#### 与其他概念的比较

1. **Preimage resistance（抗原像性）**：给定一个哈希值，很难找到一个输入，使得这个输入的哈希值等于给定的哈希值
2. **Second preimage resistance（抗第二原像性）**：给定一个输入及其对应的哈希值，很难找到另一个不同的输入，使得这个不同的输入的哈希值与第一个输入的哈希值相同

### 2. Hiding（隐藏性）

在密码学中，**hiding（隐藏性）** 是指哈希函数的一个属性，通常与承诺方案（commitment schemes）相关。隐藏性确保了即使知道哈希值，也不能推测出输入值的任何信息。

#### 隐藏性的特点

1. **信息隐藏**：给定一个哈希值，应该无法推断出可能产生该哈希值的输入是什么
2. **不可预测性**：即使攻击者知道哈希值和部分信息，也不能轻易猜测出剩余的隐藏信息

#### 示例：承诺方案中的隐藏性

假设你想和别人玩一个游戏，你要选择一个值，但你不想在开始时公开这个值（防止对方作弊）。你可以将这个值通过一个哈希函数生成哈希值，然后公开这个哈希值。当游戏结束时，你再公开原始值，对方可以验证这个值的哈希值是否与之前公开的一致。

### 3. Puzzle-friendly

**Puzzle-friendly** 是密码学中描述哈希函数特性的一种术语，通常用于讨论在某些加密协议或共识机制中的应用，尤其是在区块链中。

#### Puzzle-friendly 的特性

1. **计算成本高**：要找到满足条件的哈希值，通常需要进行大量的计算
2. **不可预测性**：由于哈希函数的不可逆性和抗碰撞性，在进行计算之前无法预见哪一个输入会生成所需的哈希值
3. **公平性**：由于每个人在解这个"谜题"时都必须做相似的工作量，所以在分布式系统或区块链中，这样的哈希函数可以帮助保证系统的公平性

#### 示例：工作量证明（Proof of Work）

在区块链系统中，尤其是比特币这样的加密货币中，工作量证明机制依赖于"puzzle-friendly"哈希函数。矿工们必须找到一个区块头的哈希值，使得这个哈希值低于某个目标难度值。

---

## 数字承诺（Digital commitment）

**Digital commitment（数字承诺）** 是密码学中用于保证数据隐私性和完整性的一种协议或机制。它允许一个人（承诺者）在不透露特定信息内容的情况下"承诺"某个值，然后在未来的某个时间点"揭示"该值。

### 数字承诺的两个关键属性

1. **隐藏性（Hiding）**：在承诺阶段，承诺者发布的承诺值不泄露所承诺的原始信息
2. **绑定性（Binding）**：一旦承诺者发布了一个承诺值，他们就无法改变承诺的内容

### 数字承诺的工作过程

1. **承诺阶段（Commit Phase）**：承诺者选择一个秘密值，然后通过某种加密方式生成一个承诺值，将这个承诺值发布或发送给验证者
2. **揭示阶段（Reveal Phase）**：在适当的时间点，承诺者揭示最初的秘密值，验证者可以使用之前的承诺值来验证揭示的值是否正确

---

## 签名技术

### 公钥（public key）与私钥（private key）

它们是密码学中非对称加密的一部分，通常用于保护数据的安全性和隐私性。

#### 公钥（Public Key）

- **定义**：公钥是一个公开的密钥，任何人都可以获取和使用
- **用途**：
  - **加密**：在加密通信中，公钥用于加密消息
  - **数字签名验证**：公钥还用于验证数字签名的真实性
- **公开性**：正如名字所示，公钥是可以自由发布和共享的，不需要保密

#### 私钥（Private Key）

- **定义**：私钥是一个秘密的密钥，必须妥善保管，不得泄露
- **用途**：
  - **解密**：在加密通信中，私钥用于解密由公钥加密的数据
  - **数字签名**：私钥用于生成数字签名，以确保信息的真实性和不可否认性
- **保密性**：私钥必须严格保密，任何泄露都会导致安全风险

#### 公钥和私钥的关系

公钥和私钥是一对密钥，它们是通过某种数学算法生成的，具有以下特性：

- 公钥和私钥可以互相配合使用
- 用公钥加密的信息只能用对应的私钥解密，反之亦然
- 公钥和私钥之间的数学关系使得公钥能够验证由私钥生成的数字签名

#### 示例：非对称加密和数字签名

1. **非对称加密**：Alice 想给 Bob 发送一条保密消息。她使用 Bob 的公钥加密这条消息，然后发送给 Bob。由于只有 Bob 拥有与公钥对应的私钥，所以只有 Bob 可以解密并阅读这条消息

2. **数字签名**：Bob 想证明他发送的一条消息的真实性和完整性。他用自己的**私钥对消息进行签名**，然后将消息和签名一起发送给 Alice。Alice 可以用 Bob 的**公钥验证签名**，以确认这条消息确实来自 Bob，并且在传输过程中没有被篡改

---

## 总结

### 比特币中的密码学原理

比特币包含的密码学原理就是**哈希函数**以及**签名**。哈希函数的一些特性以及签名的方式保证了比特币的安全性。

### 核心要点

- **哈希的特性以及理解**
- **签名的概念以及原理**
- **数字承诺的应用场景**
- **公钥私钥体系的工作原理**
